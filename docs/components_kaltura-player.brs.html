<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>components/kaltura-player.brs - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-associative-array.html">associative-array</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-associative-array.html#.AssociativeArrayUtil">AssociativeArrayUtil</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-base-plugin.html">base-plugin</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.getConfig">getConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.getName">getName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.initialize">initialize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.isValid">isValid</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.loadMedia">loadMedia</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-base-plugin.html#.updateConfig">updateConfig</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-fake-event.html">fake-event</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-fake-event.html#.addEventListener">addEventListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-fake-event.html#.dispatchEvent">dispatchEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-fake-event.html#.init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-fake-event.html#.removeEventListener">removeEventListener</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-fake-event.html#.removeEventListeners">removeEventListeners</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-kaltura-player.html">kaltura-player</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.createRequestBuilder">createRequestBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getAudioTracks">getAudioTracks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getConfig">getConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getCurrentAudioTrack">getCurrentAudioTrack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getCurrentTextTrack">getCurrentTextTrack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getCurrentTime">getCurrentTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getDuration">getDuration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getHeight">getHeight</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getKalturaPlayerEvents">getKalturaPlayerEvents</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getMediaConfig">getMediaConfig</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getMediaInfo">getMediaInfo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getPoster">getPoster</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getProviderResponse">getProviderResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getTextTracks">getTextTracks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getVideoElement">getVideoElement</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.getWidth">getWidth</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.hideTextTrack">hideTextTrack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.isLive">isLive</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.isMuted">isMuted</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.load">load</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.loaded">loaded</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.loadMedia">loadMedia</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.pause">pause</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.play">play</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.ready">ready</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.seekToLiveEdge">seekToLiveEdge</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.selectAudioTrack">selectAudioTrack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.selectTextTrack">selectTextTrack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setCurrentTime">setCurrentTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setHeight">setHeight</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setLoop">setLoop</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setMedia">setMedia</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setMute">setMute</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setPreload">setPreload</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setup">setup</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-kaltura-player.html#.setWidth">setWidth</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-kaltura-player-event.html">kaltura-player-event</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-main.html">main</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-main.html#.Main">Main</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-plugin-manager.html">plugin-manager</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.getAll">getAll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.load">load</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.loadMedia">loadMedia</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-plugin-manager.html#.reset">reset</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-poster.html">poster</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-sample.html">sample</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-sample.html#.eventHandler">eventHandler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-sample.html#.init">init</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-sample.html#.loaded">loaded</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-sample.html#.ready">ready</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">components/kaltura-player.brs</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>sub init()
  m._playkitLib = m.top.FindNode("PlaykitLib")
  m._playkitLib.observeField("loadStatus", "_onLoadStatusChanged")
  m._providerLib = m.top.FindNode("PlaykitProviderLib")
  m._providerLib.observeField("loadStatus", "_onLoadStatusChanged")
  m._ottAnaylticsLib = m.top.FindNode("PlaykitOTTAnalyticsLib")
  m._ottAnaylticsLib.observeField("loadStatus", "_onLoadStatusChanged")

  _setDefaultValues()
end sub

 sub _onLoadStatusChanged()
   print "core " m._playkitLib.loadStatus " provider " m._providerLib.loadStatus " analytics " m._ottAnaylticsLib.loadStatus
   if (m._playkitLib.loadStatus = "ready" and m._providerLib.loadStatus = "ready" and m._ottAnaylticsLib.loadStatus = "ready")

     m._playkitLib.unobserveField("loadStatus")
     m._providerLib.unobserveField("loadStatus")
     m._ottAnaylticsLib.unobserveField("loadStatus")

     m._player = CreateObject("roSGNode", "PlaykitLib:Player")
     m._events = AssociativeArrayUtil().mergeDeep(m._events, m._player.callFunc("getPlayerEvents"))

     m._pluginManager = CreateObject("roSGNode", "PluginManager")
     m._provider = CreateObject("roSGNode", "PlaykitProviderLib:OTTProvider")

     m._loadedState = true
     m.top.callFunc("dispatchEvent", m._events.KALTURA_PLAYER_LOADED)

     m.top.appendChild(m._player)
     m._player.setFocus(true)

   endif
 end sub

function _sourceSelectedListener(event as string, payload as object) as void
  m._readyState = true
  m.top.callFunc("dispatchEvent", m._events.MEDIA_LOADED)
end function

function _attach() as object
  playerEvents = m._player.callFunc("getPlayerEvents")

  for each event in playerEvents
    m._player.callFunc("addEventListener", playerEvents[event], m.top, "dispatchEvent")
  end for

  m._player.callFunc("addEventListener", playerEvents.SOURCE_SELECTED, m.top, "_sourceSelectedListener")
end function

function _detach() as object
  playerEvents = m._player.callFunc("getPlayerEvents")

  for each event in playerEvents
    m._player.callFunc("removeEventListeners", playerEvents[event], m.top)
  end for
end function

function _setDefaultValues()
  m._loadedState = false
  m._readyState = false
  m._events = _getEvents()
  m._isInitialized = invalid
  m._mediaInfo = invalid
end function

function _selectPoster(config as object,mediaConfig as object) as string
  displaySize = CreateObject("roDeviceInfo").GetDisplaySize()
  if config &lt;> invalid and config.sources &lt;> invalid and mediaConfig &lt;> invalid and mediaConfig.sources &lt;> invalid
    return _getKalturaPoster(config.sources,mediaConfig.sources,displaySize)
  endif
  return ""
end function

function _initialize(config as object)
  print "[ initialize kaltura player ]"
  m._isInitialized = true
  if config = invalid then return invalid
  m._player.callFunc("initialize", config)
  m._provider.callFunc("initialize",config.provider)
  _attach()
end function

function setup(config as object)
  _initialize(config)
end function

function loaded() as boolean
  return m._loadedState
end function

function ready() as boolean
  return m._readyState
end function

function _configureOrLoadPlugins(plugins as object) as object
  plugins_tmp = plugins
  if plugins &lt;> invalid
    for each key in plugins.Keys()
      plugin = m._pluginManager.callFunc("get",key)
      if plugin &lt;> invalid
        plugin.callFunc("updateConfig",plugins[key])
        plugins_tmp.AddReplace(key, plugin.callFunc("getConfig"))
      else
        if m._player.callFunc("getSrc") &lt;> ""
          plugins_tmp.Delete(key)
        else
          m._pluginManager.callFunc("load",key,m.top,plugins[key])
        end if
      end if
    end for
  end if
  return plugins_tmp
end function

function createRequestBuilder() as object
    return CreateObject("roSGNode", "PlaykitProviderLib:RequestBuilder")
end function

function getKalturaPlayerEvents() as object
  return m._events
end function

function configure(config={} as object) as void
  config_tmp = AssociativeArrayUtil().mergeDeep(config, m._player.callFunc("getConfig"))
  config_tmp.plugins = AssociativeArrayUtil().mergeDeep(_configureOrLoadPlugins(config_tmp.plugins), config_tmp.plugins)
  m._player.callFunc("configure", config_tmp)
end function

function loadMedia(mediaInfo as object) as void
  m._mediaInfo = mediaInfo
  m._provider.observeField("responseData", "getProviderResponse")
  m._provider.callFunc("getMediaConfig",m._mediaInfo)
  m._pluginManager.callFunc("loadMedia",mediaInfo)
end function

function setMedia(mediaConfig as object) as void
  print "[ setMedia ]"
  playerConfig = AssociativeArrayUtil().mergeDeep(mediaConfig, m._player.callFunc("getConfig"))
  config_tmp = AssociativeArrayUtil().mergeDeep({"sources":{"poster": _selectPoster(m._player.callFunc("getConfig"), mediaConfig)}}, playerConfig)
  config_tmp.plugins = _configureOrLoadPlugins(config_tmp.plugins)
  m._player.callFunc("configure", config_tmp)
end function

function getDuration() as integer
  return m._player.callFunc("getDuration")
end function

function getMediaInfo() as object
  if m._mediaInfo &lt;> invalid
    return m._mediaInfo
  else
    return {}
  end if
end function

function getMediaConfig() as object
  return {
    sources: m._player.callFunc("getConfig").sources
    plugins: m._player.callFunc("getConfig").plugins
  }
end function

function getPoster() as string
  if config &lt;> invalid and config.sources &lt;> invalid
    return config.sources.poster
  endif
end function

function reset()
  m._player.callFunc("reset")
  m._pluginManager.callFunc("reset")
  _setDefaultValues()
  _detach()
end function

function destroy()
  m._player.callFunc("destroy")
  m._pluginManager.callFunc("destroy")
  reset()
  m.top.removeChild(m._ottAnaylticsLib)
  m.top.removeChild(m._playkitLib)
  m.top.removeChild(m._providerLib)
  m.top.removeChild(m._player)
  m._ottAnaylticsLib = invalid
  m._playkitLib = invalid
  m._providerLib = invalid
  m._player = invalid
  m._provider = invalid
end function

function play() as void
  m._player.callFunc("play")
end function

function pause() as void
  m._player.callFunc("pause")
end function

function setPreload() as void
  m._player.callFunc("setPreload")
end function

function load(startTime=0 as integer) as void
  m._player.callFunc("load", startTime)
end function

function setLoop(isLoop as boolean) as void
  m._player.callFunc("setLoop",isLoop)
end function

function isMuted() as boolean
  m._player.callFunc("isMuted")
end function

function setMute(isMuted as boolean) as void
  m._player.callFunc("setMute",isMuted)
end function

function getConfig() as object
  return m._player.callFunc("getConfig")
end function

function getAudioTracks() as object
  return m._player.callFunc("getAudioTracks")
end function

function getCurrentAudioTrack() as object
  return m._player.callFunc("getCurrentAudioTrack")
end function

function selectAudioTrack(track as object) as object
  m._player.callFunc("selectAudioTrack", track)
end function

function getTextTracks() as object
  return m._player.callFunc("getTextTracks")
end function

function getCurrentTextTrack() as object
  return m._player.callFunc("getCurrentTextTrack")
end function

function selectTextTrack(track as object) as void
  m._player.callFunc("selectTextTrack", track)
end function

function hideTextTrack() as void
  m._player.callFunc("hideTextTrack")
end function

function seekToLiveEdge() as void
  m._player.callFunc("seekToLiveEdge")
end function

function isLive() as boolean
  return m._player.callFunc("isLive")
end function

function getVideoElement() as object
  return m._player.callFunc("getVideoElement")
end function

function getCurrentTime() as integer
  return m._player.callFunc("getCurrentTime")
end function

function setCurrentTime(currentTime as integer) as void
  m._player.callFunc("setCurrentTime",currentTime)
end function

function getHeight() as integer
  return m._player.callFunc("getHeight")
end function

function setHeight(height as integer) as void
  m._player.callFunc("setHeight",height)
end function

function getWidth() as integer
  return m._player.callFunc("getWidth")
end function

function setWidth(width as integer) as void
  m._player.callFunc("setWidth",width)
end function

sub getProviderResponse()
  print "[ getProviderResponse ]"
  m._provider.unobserveField("responseData")

  if not m._provider.responseData["hasError"]
    setMedia(m._provider.responseData["data"])
  else
    m.top.callFunc("dispatchEvent", m._events.ERROR, m._provider.responseData["data"])
  end if
end sub
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Tue Jun 09 2020 21:05:22 GMT+0300 (IDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
